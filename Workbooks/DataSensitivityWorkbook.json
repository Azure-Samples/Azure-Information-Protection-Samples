{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "value::selected"
        ],
        "parameters": [
          {
            "id": "bd13d665-f86b-49f2-b081-4eaed3a7674d",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "description": "Select at least one workspace that contains classification and labeling data",
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces'\r\n| project id",
            "crossComponentResources": [
              "value::selected"
            ],
            "typeSettings": {
              "resourceTypeFilter": {
                "microsoft.operationalinsights/workspaces": true
              },
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "defaultValue": "value::all",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "96f40e28-0b8a-4121-8dda-d32d8a37feb8",
            "version": "KqlParameterItem/1.0",
            "name": "Time",
            "type": 4,
            "value": {
              "durationMs": 2592000000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 2592000000
                }
              ]
            },
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "24fa1da4-95d8-41ee-98dd-59870a3dfd20",
            "version": "KqlParameterItem/1.0",
            "name": "CloudProvider",
            "label": "Cloud Provider",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n    { \"value\":\"Azure\", \"label\":\"Azure\", \"selected\":true },\r\n    { \"value\":\"Amazon\", \"label\":\"Amazon Web Services\", \"selected\":true }\r\n]",
            "value": [
              "Azure",
              "Amazon"
            ]
          },
          {
            "id": "817265c3-f308-44e0-a24c-33dac7ee2c91",
            "version": "KqlParameterItem/1.0",
            "name": "DataSource",
            "label": "Resource Type",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\"\r\n| distinct SourceType",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "value": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "Time",
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "379d1344-526c-44f3-93d2-0c9ae5b979af",
            "version": "KqlParameterItem/1.0",
            "name": "Region",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "PurviewDataSensitivityLogs\r\n| where SourceRegion != \"\"\r\n| summarize arg_max(TimeGenerated, *) by SourceRegion\r\n| project SourceRegion",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "Time",
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "value": [
              "value::all"
            ]
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "parameters - 0"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "d253ece1-2878-4374-b64b-8cba5b2dbcea",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Overview",
            "subTarget": "Overview",
            "style": "link"
          },
          {
            "id": "cbd00dbd-b6ee-43a5-ab29-3453e7c3720d",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Classifications",
            "subTarget": "Classifications",
            "style": "link"
          },
          {
            "id": "de5e833e-af7e-4e57-b92b-52ef4619713b",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Sensitivity Labels",
            "subTarget": "Labels",
            "style": "link"
          },
          {
            "id": "69734e4b-4811-4079-a9b2-f76383ea998e",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Search",
            "subTarget": "Search",
            "style": "link"
          }
        ]
      },
      "name": "links - 9"
    },
    {
      "type": 1,
      "content": {
        "json": "## Information Protection\r\n"
      },
      "name": "text - 10 - Copy"
    },
    {
      "type": 1,
      "content": {
        "json": "##### Value to Customers\r\n\r\nIt provides enterprises with:\r\n- A data discovery solution using automated scanning technology for sensitivity and malware\r\n- A unified view of the data estate with risk insights across their multi-cloud assets\r\n- A consolidated threat protection experience for data within Microsoft Defender for Cloud\r\n\r\n##### Definitions\r\nAn asset is the granular data object within Azure Purview, like a blob within Azure Blob Storage"
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Overview"
      },
      "customWidth": "50",
      "name": "text - 10 - Copy - Copy"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\" \r\n| extend CloudProvider = iff((SourceType contains \"Amazon\"), \"Amazon Web Services\", \"Azure\")\r\n| summarize arg_max(AssetPath, SourcePath, SourceType, CloudProvider) by AssetPath \r\n| summarize ResourceCount = count() by CloudProvider;",
        "size": 3,
        "title": "Total assets per cloud",
        "timeContext": {
          "durationMs": 2592000000
        },
        "timeContextFromParameter": "Time",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "piechart",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "SourceType",
            "formatter": 16,
            "formatOptions": {
              "showIcon": true
            }
          },
          "leftContent": {
            "columnMatch": "AssetClassifiedCount",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "maximumFractionDigits": 2,
                "maximumSignificantDigits": 3
              },
              "emptyValCustomText": "0"
            }
          },
          "secondaryContent": {
            "columnMatch": "AssetCount"
          },
          "showBorder": true
        },
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "Amazon",
              "color": "orange"
            }
          ]
        },
        "mapSettings": {
          "locInfo": "LatLong",
          "sizeSettings": "AssetClassifiedCount",
          "sizeAggregation": "Sum",
          "legendMetric": "AssetClassifiedCount",
          "legendAggregation": "Sum",
          "itemColorSettings": {
            "type": "heatmap",
            "colorAggregation": "Sum",
            "nodeColorField": "AssetClassifiedCount",
            "heatmapPalette": "greenRed"
          }
        }
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Overview"
      },
      "customWidth": "50",
      "name": "query - 25 - Copy",
      "styleSettings": {
        "maxWidth": "100"
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "  ",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Azure"
            },
            "name": "text - 0"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let allAssets = PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\" \r\n| where SourceType contains \"Azure\"\r\n| distinct AssetPath, SourcePath, SourceType\r\n| summarize AssetCount = count() by SourceType;\r\n\r\nlet classifiedAssets =  PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\" \r\n| where SourceType contains \"Azure\"\r\n| mv-expand Classification\r\n| where Classification != \"\"\r\n| distinct AssetPath, SourcePath, SourceType\r\n| summarize AssetClassifiedCount = count() by SourceType;\r\n\r\nlet ClassifiedAssetsByResourceType = allAssets\r\n| join kind= leftouter classifiedAssets on SourceType\r\n| extend ClassifiedPercentage = strcat(round((100.0 * AssetClassifiedCount / AssetCount),2), \"%\")\r\n| extend AssetCount = strcat(AssetCount, \" assets found in total\")\r\n| project SourceType, AssetCount, AssetClassifiedCount, ClassifiedPercentage;\r\n\r\nClassifiedAssetsByResourceType",
              "size": 1,
              "title": "Number of classified assets",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "Time",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "SourceType",
                  "formatter": 16,
                  "formatOptions": {
                    "showIcon": true
                  }
                },
                "leftContent": {
                  "columnMatch": "AssetClassifiedCount",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    },
                    "emptyValCustomText": "0"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "AssetCount"
                },
                "showBorder": true
              },
              "mapSettings": {
                "locInfo": "LatLong",
                "sizeSettings": "AssetClassifiedCount",
                "sizeAggregation": "Sum",
                "legendMetric": "AssetClassifiedCount",
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "type": "heatmap",
                  "colorAggregation": "Sum",
                  "nodeColorField": "AssetClassifiedCount",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "customWidth": "100",
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "Overview"
            },
            "name": "query - 25",
            "styleSettings": {
              "maxWidth": "100"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let allAssets = PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\" \r\n| where SourceType contains \"Azure\"\r\n| distinct AssetPath, SourcePath, SourceType\r\n| summarize AssetCount = count() by SourceType;\r\n\r\nlet classifiedAssets =  PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\" \r\n| where SourceType contains \"Azure\"\r\n| mv-expand Classification\r\n| where Classification != \"\"\r\n| distinct AssetPath, SourcePath, SourceType\r\n| summarize AssetClassifiedCount = count() by SourceType;\r\n\r\nlet ClassifiedAssetsByResourceType = allAssets\r\n| join kind= leftouter classifiedAssets on SourceType\r\n| extend ClassifiedPercentage = strcat(round((100.0 * AssetClassifiedCount / AssetCount),2), \"%\")\r\n| project SourceType, AssetCount, AssetClassifiedCount, ClassifiedPercentage;\r\n\r\nClassifiedAssetsByResourceType",
              "size": 1,
              "title": "Percentage of classified assets",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "Time",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "AssetCount",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  },
                  {
                    "columnMatch": "AssetClassifiedCount",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "SourceType",
                    "label": "Source Type"
                  },
                  {
                    "columnId": "AssetCount",
                    "label": "Asset Count"
                  },
                  {
                    "columnId": "AssetClassifiedCount",
                    "label": "Asset Classified Count"
                  },
                  {
                    "columnId": "ClassifiedPercentage",
                    "label": "Classified Percentage"
                  }
                ]
              },
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "SourceType",
                  "formatter": 16,
                  "formatOptions": {
                    "showIcon": true
                  }
                },
                "leftContent": {
                  "columnMatch": "AssetClassifiedCount",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    },
                    "emptyValCustomText": "0"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "AssetCount"
                },
                "showBorder": true
              },
              "mapSettings": {
                "locInfo": "LatLong",
                "sizeSettings": "AssetClassifiedCount",
                "sizeAggregation": "Sum",
                "legendMetric": "AssetClassifiedCount",
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "type": "heatmap",
                  "colorAggregation": "Sum",
                  "nodeColorField": "AssetClassifiedCount",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "customWidth": "100",
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "Overview"
            },
            "name": "query - 25 - Copy",
            "styleSettings": {
              "maxWidth": "100"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let NumberofSourcesByRegion = PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\" \r\n| where SourceType contains \"Azure\"\r\n| summarize arg_max(AssetPath, SourcePath, SourceType, SourceRegion) by AssetPath \r\n| summarize AssetCount = count() by SourceRegion;\r\n\r\nNumberofSourcesByRegion",
              "size": 0,
              "title": "Data source region",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "Time",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "map",
              "mapSettings": {
                "locInfo": "AzureLoc",
                "locInfoColumn": "SourceRegion",
                "sizeSettings": "AssetCount",
                "sizeAggregation": "Sum",
                "legendMetric": "AssetCount",
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "nodeColorField": "AssetCount",
                  "colorAggregation": "Sum",
                  "type": "heatmap",
                  "heatmapPalette": "purpleBlue"
                }
              }
            },
            "customWidth": "100",
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "Overview"
            },
            "name": "query - 33"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\" \r\n| where SourceType contains \"Azure\"\r\n| summarize arg_max(AssetPath, SourcePath, FileExtension) by AssetPath \r\n| summarize count() by FileExtension\r\n| sort by count_ desc",
              "size": 1,
              "title": "File Extensions",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "Time",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "labelSettings": [
                  {
                    "columnId": "FileExtension",
                    "label": "File Extension"
                  },
                  {
                    "columnId": "count_",
                    "label": "Count"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "Overview"
            },
            "name": "query - 6"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let SensitivityLabels = PurviewDataSensitivityLogs\r\n| where ActivityType == \"Labeling\" \r\n| where SourceType contains \"Azure\"\r\n| mv-expand SensitivityLabel\r\n| extend newSensitivityLabel = tostring(SensitivityLabel)\r\n| summarize arg_max(newSensitivityLabel, SourceType, FileSize) by AssetPath \r\n| summarize AssetCount = count() by newSensitivityLabel\r\n| sort by AssetCount;\r\n\r\nSensitivityLabels",
              "size": 4,
              "title": "Top sensitivity labels found",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "Time",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "newSensitivityLabel",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      },
                      "emptyValCustomText": "No Label"
                    }
                  },
                  {
                    "columnMatch": "AssetCount",
                    "formatter": 1
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "newSensitivityLabel",
                    "label": "Sensitivity Label"
                  },
                  {
                    "columnId": "AssetCount",
                    "label": "Asset Count"
                  }
                ]
              },
              "sortBy": []
            },
            "customWidth": "50",
            "name": "query - 4"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Classifications = PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\"\r\n| where SourceType contains \"Azure\"\r\n| summarize arg_max(TimeGenerated, Classification, FileSize, AssetType) by AssetPath \r\n| extend classifications = split(Classification, ',')\r\n| mv-expand classifications\r\n| extend Classification = trim(@\"[^\\w]+\", tostring(classifications))\r\n| where Classification != \"\"\r\n| summarize AssetCount = count() by Classification\r\n| project Classification, AssetCount\r\n| top 4 by AssetCount;\r\n\r\nClassifications",
              "size": 1,
              "title": "Top classifications found",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "Time",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "AssetCount",
                    "formatter": 1
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "AssetCount",
                    "label": "Asset Count"
                  }
                ]
              },
              "sortBy": [],
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "SourcePath",
                  "formatter": 13,
                  "formatOptions": {
                    "linkTarget": null,
                    "showIcon": true
                  }
                },
                "subtitleContent": {
                  "columnMatch": "AssetPath"
                },
                "leftContent": {
                  "columnMatch": "ClassificationCount",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": true,
                "size": "full"
              }
            },
            "customWidth": "50",
            "name": "query - 19 - Copy"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Overview"
      },
      "customWidth": "50",
      "name": "group - 22",
      "styleSettings": {
        "margin": "10px",
        "padding": "10px",
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": " ",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Amazon Web Services"
            },
            "name": "text - 0"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let allAssets = PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\" \r\n| where SourceType contains \"Amazon\"\r\n| distinct AssetPath, SourcePath, SourceType\r\n| summarize AssetCount = count() by SourceType;\r\n\r\nlet classifiedAssets =  PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\" \r\n| where SourceType contains \"Amazon\"\r\n| mv-expand Classification\r\n| where Classification != \"\"\r\n| distinct AssetPath, SourcePath, SourceType\r\n| summarize AssetClassifiedCount = count() by SourceType;\r\n\r\nlet ClassifiedAssetsByResourceType = allAssets\r\n| join kind= leftouter classifiedAssets on SourceType\r\n| extend ClassifiedPercentage = strcat(round((100.0 * AssetClassifiedCount / AssetCount),2), \"%\")\r\n| extend AssetCount = strcat(AssetCount, \" assets found in total\")\r\n| project SourceType, AssetCount, AssetClassifiedCount, ClassifiedPercentage;\r\n\r\nClassifiedAssetsByResourceType",
              "size": 1,
              "title": "Number of classified assets",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "Time",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "SourceType",
                  "formatter": 16,
                  "formatOptions": {
                    "showIcon": true
                  }
                },
                "leftContent": {
                  "columnMatch": "AssetClassifiedCount",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    },
                    "emptyValCustomText": "0"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "AssetCount"
                },
                "showBorder": true
              }
            },
            "customWidth": "100",
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "Overview"
            },
            "name": "query - 25",
            "styleSettings": {
              "maxWidth": "100"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let allAssets = PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\" \r\n| where SourceType contains \"Amazon\"\r\n| distinct AssetPath, SourcePath, SourceType\r\n| summarize AssetCount = count() by SourceType;\r\n\r\nlet classifiedAssets =  PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\" \r\n| where SourceType contains \"Amazon\"\r\n| mv-expand Classification\r\n| where Classification != \"\"\r\n| distinct AssetPath, SourcePath, SourceType\r\n| summarize AssetClassifiedCount = count() by SourceType;\r\n\r\nlet ClassifiedAssetsByResourceType = allAssets\r\n| join kind= leftouter classifiedAssets on SourceType\r\n| extend ClassifiedPercentage = strcat(round((100.0 * AssetClassifiedCount / AssetCount),2), \"%\")\r\n| project SourceType, AssetCount, AssetClassifiedCount, ClassifiedPercentage;\r\n\r\nClassifiedAssetsByResourceType",
              "size": 1,
              "title": "Percentage of classified assets",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "Time",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "AssetCount",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  },
                  {
                    "columnMatch": "AssetClassifiedCount",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "SourceType",
                    "label": "Source Type"
                  },
                  {
                    "columnId": "AssetCount",
                    "label": "Asset Count"
                  },
                  {
                    "columnId": "AssetClassifiedCount",
                    "label": "Asset Classified Count"
                  },
                  {
                    "columnId": "ClassifiedPercentage",
                    "label": "Classified Percentage"
                  }
                ]
              },
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "SourceType",
                  "formatter": 16,
                  "formatOptions": {
                    "showIcon": true
                  }
                },
                "leftContent": {
                  "columnMatch": "AssetClassifiedCount",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    },
                    "emptyValCustomText": "0"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "AssetCount"
                },
                "showBorder": true
              },
              "mapSettings": {
                "locInfo": "LatLong",
                "sizeSettings": "AssetClassifiedCount",
                "sizeAggregation": "Sum",
                "legendMetric": "AssetClassifiedCount",
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "type": "heatmap",
                  "colorAggregation": "Sum",
                  "nodeColorField": "AssetClassifiedCount",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "customWidth": "100",
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "Overview"
            },
            "name": "query - 25 - Copy - Copy",
            "styleSettings": {
              "maxWidth": "100"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let NumberofSourcesByRegion = PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\" \r\n| where SourceType contains \"Amazon\"\r\n| distinct AssetPath, SourceRegion\r\n| summarize AssetCount = count() by SourceRegion;\r\n\r\nNumberofSourcesByRegion",
              "size": 0,
              "title": "Data source region",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "Time",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "labelSettings": [
                  {
                    "columnId": "SourceRegion",
                    "label": "Source Region"
                  },
                  {
                    "columnId": "AssetCount",
                    "label": "Asset Count"
                  }
                ]
              },
              "mapSettings": {
                "locInfo": "CountryRegion",
                "locInfoColumn": "SourceRegion",
                "sizeSettings": "AssetCount",
                "sizeAggregation": "Sum",
                "legendMetric": "AssetCount",
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "nodeColorField": "AssetCount",
                  "colorAggregation": "Sum",
                  "type": "heatmap",
                  "heatmapPalette": "purpleBlue"
                }
              }
            },
            "customWidth": "100",
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "Overview"
            },
            "name": "query - 33 - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\" \r\n| where SourceType contains \"Amazon\"\r\n| distinct AssetPath, FileExtension\r\n| summarize count() by FileExtension\r\n| sort by count_ desc",
              "size": 1,
              "title": "File Extensions",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "Time",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "labelSettings": [
                  {
                    "columnId": "FileExtension",
                    "label": "File Extension"
                  },
                  {
                    "columnId": "count_",
                    "label": "Count"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "Overview"
            },
            "name": "query - 6"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let SensitivityLabels = PurviewDataSensitivityLogs\r\n| where ActivityType == \"Labeling\" \r\n| where SourceType contains \"Amazon\"\r\n| mv-expand SensitivityLabel\r\n| extend newSensitivityLabel = tostring(SensitivityLabel)\r\n| summarize arg_max(newSensitivityLabel, SourceType, FileSize) by AssetPath \r\n| summarize AssetCount = count() by newSensitivityLabel\r\n| sort by AssetCount;\r\n\r\nSensitivityLabels",
              "size": 4,
              "title": "Top sensitivity labels found",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "Time",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "AssetCount",
                    "formatter": 1
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "newSensitivityLabel",
                    "label": "Sensitivity Label"
                  },
                  {
                    "columnId": "AssetCount",
                    "label": "Asset Count"
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "query - 4"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Classifications = PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\"\r\n| where SourceType contains \"Amazon\"\r\n| summarize arg_max(TimeGenerated, Classification, FileSize, AssetType) by AssetPath \r\n| extend classifications = split(Classification, ',')\r\n| mv-expand classifications\r\n| extend Classification = trim(@\"[^\\w]+\", tostring(classifications))\r\n| where Classification != \"\"\r\n| summarize AssetCount = count() by Classification\r\n| project Classification, AssetCount\r\n| top 4 by AssetCount;\r\n\r\nClassifications",
              "size": 1,
              "title": "Top classifications found",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "Time",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "AssetCount",
                    "formatter": 1
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "AssetCount",
                    "label": "Asset Count"
                  }
                ]
              },
              "sortBy": [],
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "SourcePath",
                  "formatter": 13,
                  "formatOptions": {
                    "linkTarget": null,
                    "showIcon": true
                  }
                },
                "subtitleContent": {
                  "columnMatch": "AssetPath"
                },
                "leftContent": {
                  "columnMatch": "ClassificationCount",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": true,
                "size": "full"
              }
            },
            "customWidth": "50",
            "name": "query - 19 - Copy"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Overview"
      },
      "customWidth": "50",
      "name": "group - 22 - Copy",
      "styleSettings": {
        "margin": "10px",
        "padding": "10px",
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "PurviewDataSensitivityLogs\r\n| where ClassificationCount > 0\r\n| project logTime = format_datetime(TimeGenerated, 'yy-MM-dd'), SourceType\r\n| summarize ClassifiedAssetCount = count() by logTime, SourceType",
        "size": 0,
        "timeContext": {
          "durationMs": 2592000000
        },
        "timeContextFromParameter": "Time",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "SourceType",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "ClassifiedAssetCount",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "maximumFractionDigits": 2,
                "maximumSignificantDigits": 3
              }
            }
          },
          "secondaryContent": {
            "columnMatch": "logTime"
          },
          "showBorder": false
        },
        "graphSettings": {
          "type": 0,
          "topContent": {
            "columnMatch": "logTime",
            "formatter": 1
          },
          "centerContent": {
            "columnMatch": "AssetCount",
            "formatter": 1,
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        },
        "mapSettings": {
          "locInfo": "LatLong",
          "sizeSettings": "AssetCount",
          "sizeAggregation": "Sum",
          "legendMetric": "AssetCount",
          "legendAggregation": "Sum",
          "itemColorSettings": {
            "type": "heatmap",
            "colorAggregation": "Sum",
            "nodeColorField": "AssetCount",
            "heatmapPalette": "greenRed"
          }
        }
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Hidden"
      },
      "name": "query - 23"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\"\r\n| where \"{DataSource:label}\" == \"All\" or SourceType in~ (split(\"{DataSource:label}\", \", \"))\r\n| where \"{Region:label}\" == \"All\" or SourceRegion in~ (split(\"{Region:label}\", \", \"))\r\n| extend CloudProvider = iff((SourceName contains \"Azure\"), \"Azure\", \"Amazon Web Services\")\r\n| where Classification != \"\"\r\n| where CloudProvider in (split(\"{CloudProvider:label}\", \", \"))\r\n| summarize ClassifiedAssetCount = count() by DateClassified = bin(TimeGenerated, 1d), SourceType",
        "size": 0,
        "showAnalytics": true,
        "title": "Classification events",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "Time",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "barchart",
        "chartSettings": {
          "xAxis": "DateClassified",
          "group": "SourceType",
          "createOtherGroup": 0
        }
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Classifications"
      },
      "customWidth": "100",
      "name": "query - 24"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let Classifications = PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\"\r\n| where \"{DataSource:label}\" == \"All\" or SourceType in~ (split(\"{DataSource:label}\", \", \"))\r\n| where \"{Region:label}\" == \"All\" or SourceRegion in~ (split(\"{Region:label}\", \", \"))\r\n| extend CloudProvider = iff((SourceName contains \"Azure\"), \"Azure\", \"Amazon Web Services\")\r\n| where CloudProvider in (split(\"{CloudProvider:label}\", \", \"))\r\n| summarize arg_max(TimeGenerated, Classification, FileSize, AssetType) by AssetPath \r\n| extend classifications = split(Classification, ',')\r\n| mv-expand classifications\r\n| extend Classification = trim(@\"[^\\w]+\", tostring(classifications))\r\n| where Classification != \"\"\r\n| summarize AssetCount = count() by Classification\r\n| project Classification, AssetCount;\r\n\r\nClassifications\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
        "size": 0,
        "showAnalytics": true,
        "title": "Classifications",
        "timeContext": {
          "durationMs": 2592000000
        },
        "timeContextFromParameter": "Time",
        "showRefreshButton": true,
        "exportFieldName": "Classification",
        "exportParameterName": "UserSelectedClassification",
        "exportDefaultValue": "All",
        "showExportToExcel": true,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Classification",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "50ch"
              }
            },
            {
              "columnMatch": "FileSize",
              "formatter": 8,
              "formatOptions": {
                "palette": "blue",
                "customColumnWidthSetting": "25ch"
              }
            },
            {
              "columnMatch": "AssetCount",
              "formatter": 4,
              "formatOptions": {
                "palette": "blue",
                "customColumnWidthSetting": "25ch"
              }
            }
          ],
          "filter": true,
          "sortBy": [
            {
              "itemKey": "$gen_bar_AssetCount_1",
              "sortOrder": 1
            }
          ],
          "labelSettings": [
            {
              "columnId": "AssetCount",
              "label": "Classified Asset Count"
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "$gen_bar_AssetCount_1",
            "sortOrder": 1
          }
        ],
        "tileSettings": {
          "showBorder": false,
          "titleContent": {
            "columnMatch": "Classification",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "Size",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        }
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Classifications"
      },
      "customWidth": "35",
      "name": "query - 4 - Copy",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let ClassificationCountColumn = PurviewDataSensitivityLogs\r\n| mv-expand ClassificationDetails\r\n| summarize ClassificationCount = sum(toint(ClassificationDetails[\"UniqueCount\"])) by AssetPath;\r\nlet ClassificationsDrilldown = PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\" \r\n| where \"{DataSource:label}\" == \"All\" or SourceType in~ (split(\"{DataSource:label}\", \", \"))\r\n| where \"{Region:label}\" == \"All\" or SourceRegion in~ (split(\"{Region:label}\", \", \"))\r\n| extend CloudProvider = iff((SourceName contains \"Azure\"), \"Azure\", \"Amazon Web Services\")\r\n| where CloudProvider in (split(\"{CloudProvider:label}\", \", \"))\r\n| extend classifications = split(Classification, ',')\r\n| mv-expand classifications\r\n| where Classification != \"\"\r\n| where \"{UserSelectedClassification:label}\" == \"All\" or Classification contains \"{UserSelectedClassification:label}\";\r\n\r\nClassificationsDrilldown | join ClassificationCountColumn on AssetPath\r\n| summarize arg_max(TimeGenerated, PurviewTenantId, PurviewAccountName, PurviewRegion, SourceName, SourceType, SourcePath, SourceSubscriptionId, SourceRegion, SourceCollectionName, AssetName, AssetPath, AssetType, AssetCreationTime, AssetModifiedTime, AssetLastScanTime, FileExtension, FileSize, ActivityType, ClassificationTrigger, Classification, ClassificationCount, ClassificationDetails, SourceScanId) by AssetPath \r\n| project TimeGenerated, PurviewTenantId, PurviewAccountName, PurviewRegion, AssetLastScanTime, AssetName, AssetPath, AssetType, AssetCreationTime, AssetModifiedTime, FileExtension, FileSize, ActivityType, ClassificationTrigger, Classification, ClassificationCount, ClassificationDetails, SourceName, SourceType, SourcePath, SourceSubscriptionId, SourceRegion, SourceCollectionName, SourceScanId;\r\n\r\nClassificationsDrilldown\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
        "size": 0,
        "showAnalytics": true,
        "title": "Classifications Drilldown- Asset Level",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "Time",
        "showRefreshButton": true,
        "showExportToExcel": true,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "TimeGenerated",
              "formatter": 5
            },
            {
              "columnMatch": "PurviewTenantId",
              "formatter": 5
            },
            {
              "columnMatch": "PurviewAccountName",
              "formatter": 5
            },
            {
              "columnMatch": "PurviewRegion",
              "formatter": 5
            },
            {
              "columnMatch": "AssetLastScanTime",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "30ch"
              }
            },
            {
              "columnMatch": "AssetName",
              "formatter": 5
            },
            {
              "columnMatch": "AssetPath",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "GenericDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "70ch"
              }
            },
            {
              "columnMatch": "AssetType",
              "formatter": 5
            },
            {
              "columnMatch": "AssetCreationTime",
              "formatter": 5
            },
            {
              "columnMatch": "AssetModifiedTime",
              "formatter": 5
            },
            {
              "columnMatch": "FileExtension",
              "formatter": 5
            },
            {
              "columnMatch": "FileSize",
              "formatter": 5
            },
            {
              "columnMatch": "ActivityType",
              "formatter": 5
            },
            {
              "columnMatch": "Classification",
              "formatter": 5
            },
            {
              "columnMatch": "ClassificationCount",
              "formatter": 5
            },
            {
              "columnMatch": "SourceName",
              "formatter": 5
            },
            {
              "columnMatch": "SourceType",
              "formatter": 5
            },
            {
              "columnMatch": "SourcePath",
              "formatter": 5
            },
            {
              "columnMatch": "SourceSubscriptionId",
              "formatter": 5
            },
            {
              "columnMatch": "SourceRegion",
              "formatter": 5
            },
            {
              "columnMatch": "SourceCollectionName",
              "formatter": 5
            },
            {
              "columnMatch": "SourceScanId",
              "formatter": 5
            },
            {
              "columnMatch": "PurviewSubscriptionId",
              "formatter": 5
            },
            {
              "columnMatch": "SourceOwner",
              "formatter": 5
            },
            {
              "columnMatch": "AssetOwner",
              "formatter": 5
            },
            {
              "columnMatch": "ActivityTrigger",
              "formatter": 5
            },
            {
              "columnMatch": "SensitivityLabelGuid",
              "formatter": 5
            },
            {
              "columnMatch": "SensitivityLabelName",
              "formatter": 5
            },
            {
              "columnMatch": "UserId",
              "formatter": 5
            }
          ],
          "rowLimit": 1000,
          "filter": true,
          "sortBy": [
            {
              "itemKey": "AssetLastScanTime",
              "sortOrder": 2
            }
          ],
          "labelSettings": [
            {
              "columnId": "AssetLastScanTime",
              "label": "Last Scan Time"
            },
            {
              "columnId": "AssetPath",
              "label": "Asset Path"
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "AssetLastScanTime",
            "sortOrder": 2
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Classifications"
      },
      "customWidth": "65",
      "name": "query - 10",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "PurviewDataSensitivityLogs\r\n| where ActivityType == \"Labeling\"\r\n| where \"{DataSource:label}\" == \"All\" or SourceType in~ (split(\"{DataSource:label}\", \", \"))\r\n| where \"{Region:label}\" == \"All\" or SourceRegion in~ (split(\"{Region:label}\", \", \"))\r\n| extend CloudProvider = iff((SourceName contains \"Azure\"), \"Azure\", \"Amazon Web Services\")\r\n| where CloudProvider in (split(\"{CloudProvider:label}\", \", \"))\r\n| where SensitivityLabel != \"\"\r\n| summarize LabeledAssetCount = count() by DateClassified = bin(TimeGenerated, 1d), SourceType",
        "size": 0,
        "showAnalytics": true,
        "title": "Labeling events",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "Time",
        "exportFieldName": "DateClassified",
        "exportParameterName": "UserSelectedTime",
        "exportDefaultValue": "All",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "categoricalbar",
        "chartSettings": {
          "xAxis": "DateClassified",
          "group": "SourceType",
          "createOtherGroup": 0
        }
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Labels"
      },
      "customWidth": "100",
      "name": "query - 24 - Copy"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let SensitivityLabels = PurviewDataSensitivityLogs\r\n| where ActivityType == \"Labeling\" \r\n| where \"{DataSource:label}\" == \"All\" or SourceType in~ (split(\"{DataSource:label}\", \", \"))\r\n| where \"{Region:label}\" == \"All\" or SourceRegion in~ (split(\"{Region:label}\", \", \"))\r\n| extend CloudProvider = iff((SourceName contains \"Azure\"), \"Azure\", \"Amazon Web Services\")\r\n| where CloudProvider in (split(\"{CloudProvider:label}\", \", \"))\r\n| mv-expand SensitivityLabel\r\n| extend newSensitivityLabel = tostring(SensitivityLabel) //iff(SensitivityLabel== \"\", \"No Label\", SensitivityLabel)\r\n| summarize arg_max(newSensitivityLabel, SourceType, FileSize) by AssetPath \r\n| summarize AssetCount = count() by newSensitivityLabel\r\n| sort by AssetCount;\r\n\r\nSensitivityLabels\r\n\r\n",
        "size": 0,
        "title": "Sensitivity Labels",
        "timeContext": {
          "durationMs": 2592000000
        },
        "timeContextFromParameter": "Time",
        "exportFieldName": "newSensitivityLabel",
        "exportParameterName": "UserSelectedLabel",
        "exportDefaultValue": "All",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "newSensitivityLabel",
              "formatter": 0,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "No Label"
              }
            },
            {
              "columnMatch": "AssetCount",
              "formatter": 4,
              "formatOptions": {
                "palette": "blue"
              }
            },
            {
              "columnMatch": "FileSize",
              "formatter": 8,
              "formatOptions": {
                "palette": "blue"
              }
            }
          ],
          "filter": true,
          "labelSettings": [
            {
              "columnId": "newSensitivityLabel",
              "label": "Sensitivity Label"
            },
            {
              "columnId": "AssetCount",
              "label": "Asset Count"
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Labels"
      },
      "customWidth": "35",
      "name": "query - 14 - Copy",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "PurviewDataSensitivityLogs\r\n| where ActivityType == \"Labeling\" \r\n| where \"{DataSource:label}\" == \"All\" or SourceType in~ (split(\"{DataSource:label}\", \", \"))\r\n| where \"{Region:label}\" == \"All\" or SourceRegion in~ (split(\"{Region:label}\", \", \"))\r\n| extend CloudProvider = iff((SourceName contains \"Azure\"), \"Azure\", \"Amazon Web Services\")\r\n| where CloudProvider in (split(\"{CloudProvider:label}\", \", \"))\r\n| mv-expand SensitivityLabel to typeof(string)\r\n| mv-expand SensitivityLabelDetails to typeof(string)\r\n| where \"{UserSelectedLabel:label}\" == \"All\" or \"{UserSelectedLabel:label}\" == SensitivityLabel\r\n| summarize arg_max(TimeGenerated, PurviewTenantId, PurviewAccountName, PurviewRegion, SourceName, SourceType, SourcePath, SourceSubscriptionId, SourceRegion, SourceCollectionName, AssetName, AssetPath, AssetType, AssetCreationTime, AssetModifiedTime, AssetLastScanTime, FileExtension, FileSize, ActivityType, SensitivityLabelTrigger, SensitivityLabel, SensitivityLabelDetails, SourceScanId) by AssetPath\r\n| project TimeGenerated, PurviewTenantId, PurviewAccountName, PurviewRegion, AssetLastScanTime, AssetName, AssetPath, AssetType, AssetCreationTime, AssetModifiedTime, FileExtension, FileSize, ActivityType, SensitivityLabelTrigger, SensitivityLabel, SensitivityLabelDetails, SourceName, SourceType, SourcePath, SourceSubscriptionId, SourceRegion, SourceCollectionName, SourceScanId\r\n| sort by AssetLastScanTime desc",
        "size": 0,
        "title": "Sensitivity Labels Drilldown- Asset Level",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "Time",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "TimeGenerated",
              "formatter": 5
            },
            {
              "columnMatch": "PurviewTenantId",
              "formatter": 5
            },
            {
              "columnMatch": "PurviewAccountName",
              "formatter": 5
            },
            {
              "columnMatch": "PurviewRegion",
              "formatter": 5
            },
            {
              "columnMatch": "AssetName",
              "formatter": 5
            },
            {
              "columnMatch": "AssetPath",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "GenericDetails",
                "linkIsContextBlade": true
              }
            },
            {
              "columnMatch": "AssetType",
              "formatter": 5
            },
            {
              "columnMatch": "AssetCreationTime",
              "formatter": 5
            },
            {
              "columnMatch": "AssetModifiedTime",
              "formatter": 5
            },
            {
              "columnMatch": "FileExtension",
              "formatter": 5
            },
            {
              "columnMatch": "FileSize",
              "formatter": 5
            },
            {
              "columnMatch": "ActivityType",
              "formatter": 5
            },
            {
              "columnMatch": "SensitivityLabelTrigger",
              "formatter": 5
            },
            {
              "columnMatch": "SensitivityLabel",
              "formatter": 5
            },
            {
              "columnMatch": "SensitivityLabelDetails",
              "formatter": 5
            },
            {
              "columnMatch": "SourceName",
              "formatter": 5
            },
            {
              "columnMatch": "SourceType",
              "formatter": 5
            },
            {
              "columnMatch": "SourcePath",
              "formatter": 5
            },
            {
              "columnMatch": "SourceSubscriptionId",
              "formatter": 5
            },
            {
              "columnMatch": "SourceRegion",
              "formatter": 5
            },
            {
              "columnMatch": "SourceCollectionName",
              "formatter": 5
            },
            {
              "columnMatch": "SourceScanId",
              "formatter": 5
            },
            {
              "columnMatch": "ClassificationCount",
              "formatter": 5
            },
            {
              "columnMatch": "PurviewSubscriptionId",
              "formatter": 5
            },
            {
              "columnMatch": "SourceOwner",
              "formatter": 5
            },
            {
              "columnMatch": "AssetOwner",
              "formatter": 5
            },
            {
              "columnMatch": "ActivityTrigger",
              "formatter": 5
            },
            {
              "columnMatch": "Classification",
              "formatter": 5
            },
            {
              "columnMatch": "SensitivityLabelGuid",
              "formatter": 5
            },
            {
              "columnMatch": "UserId",
              "formatter": 5
            }
          ],
          "rowLimit": 1000,
          "filter": true,
          "labelSettings": [
            {
              "columnId": "AssetLastScanTime",
              "label": "Last Scan Time"
            },
            {
              "columnId": "AssetPath",
              "label": "Asset Path"
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Labels"
      },
      "customWidth": "65",
      "name": "query - 15",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "parameters": [
          {
            "id": "0210ccd0-41db-4327-bc5c-ebb2b44b08b1",
            "version": "KqlParameterItem/1.0",
            "name": "Resource",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "PurviewDataSensitivityLogs\r\n| summarize by SourceName\r\n| project SourceName",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "value": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ]
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "Time",
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "a9d75fe2-c2a8-4603-a78c-aaab104eedf5",
            "version": "KqlParameterItem/1.0",
            "name": "Classification",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\"\r\n| summarize arg_max(TimeGenerated, Classification, FileSize, AssetType) by AssetPath \r\n| extend classifications = split(Classification, ',')\r\n| mv-expand classifications\r\n| extend Classification = trim(@\"[^\\w]+\", tostring(classifications))\r\n| where Classification != \"\"\r\n| summarize by Classification\r\n| project Classification",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "value": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 2592000000
            },
            "timeContextFromParameter": "Time",
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "cdb167c0-786f-458a-978a-1956df8953b0",
            "version": "KqlParameterItem/1.0",
            "name": "Label",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "PurviewDataSensitivityLogs\r\n| where ActivityType == \"Labeling\"\r\n| mv-expand SensitivityLabel to typeof(string)\r\n| where SensitivityLabel != \"\"\r\n| summarize by SensitivityLabel\r\n| project SensitivityLabel",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 2592000000
            },
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "a91d7359-42d9-4cda-a9bb-5b111b8d6d72",
            "version": "KqlParameterItem/1.0",
            "name": "PurviewAccount",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "PurviewDataSensitivityLogs\r\n| summarize by PurviewAccountName\r\n| project PurviewAccountName",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ]
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "Time",
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "f39fb857-18e7-41d0-9012-30a05b8578f2",
            "version": "KqlParameterItem/1.0",
            "name": "LastScanTime",
            "type": 2,
            "query": "PurviewDataSensitivityLogs\r\n| where AssetLastScanTime != \"\"\r\n| extend formattedLastScanTime = format_datetime(AssetLastScanTime, 'M/d/yyyy')\r\n| summarize by formattedLastScanTime\r\n| project formattedLastScanTime ",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::1"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 2592000000
            },
            "defaultValue": "value::1",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "588546d9-8822-4dcb-8e37-4c65eeae1882",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "PurviewDataSensitivityLogs\r\n| summarize by SourceSubscriptionId\r\n| project SourceSubscriptionId",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "value": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 2592000000
            },
            "timeContextFromParameter": "Time",
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Search"
      },
      "name": "parameters - 14"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let classifiedAssets = PurviewDataSensitivityLogs\r\n| where ActivityType == \"Classification\" \r\n| extend LastScanTime = format_datetime(AssetLastScanTime, 'M/d/yyyy')\r\n| where \"{LastScanTime:label}\" == \"Any one\" or \"{LastScanTime:label}\" == LastScanTime\r\n| where \"{DataSource:label}\" == \"All\" or SourceType in~ (split(\"{DataSource:label}\", \", \"))\r\n| where \"{Region:label}\" == \"All\" or SourceRegion in~ (split(\"{Region:label}\", \", \"))\r\n| where \"{PurviewAccount:label}\" == \"All\" or PurviewAccountName in~ (split(\"{PurviewAccount:label}\", \", \"))\r\n| where \"{Subscription:label}\" == \"All\" or SourceSubscriptionId in~ (split(\"{Subscription:label}\", \", \"))\r\n| extend CloudProvider = iff((SourceName contains \"Azure\"), \"Azure\", \"Amazon Web Services\")\r\n| where CloudProvider in (split(\"{CloudProvider:label}\", \", \"))\r\n| where \"{Resource:label}\" == \"All\" or SourceName in (split(\"{Resource:label}\", \", \"))\r\n| where \"{Classification:label}\" == \"All\" or Classification contains \"{Classification:label}\"\r\n| extend AssetLastScanTime = format_datetime(AssetLastScanTime, 'M/d/yyyy')\r\n| summarize arg_max(TimeGenerated, PurviewTenantId, PurviewAccountName, PurviewRegion, AssetName, AssetPath, AssetType, AssetCreationTime, AssetModifiedTime, AssetLastScanTime, FileExtension, FileSize, ActivityType, ClassificationTrigger, Classification, ClassificationDetails, SensitivityLabelTrigger, SensitivityLabel, SensitivityLabelDetails, SourceName, SourceType, SourcePath, SourceSubscriptionId, SourceRegion, SourceCollectionName, SourceScanId) by AssetPath \r\n| project TimeGenerated, PurviewTenantId, PurviewAccountName, PurviewRegion, AssetName, AssetPath, AssetType, AssetCreationTime, AssetModifiedTime, AssetLastScanTime, FileExtension, FileSize, ActivityType, ClassificationTrigger, Classification, ClassificationDetails, SensitivityLabelTrigger, SensitivityLabel, SensitivityLabelDetails, SourceName, SourceType, SourcePath, SourceSubscriptionId, SourceRegion, SourceCollectionName, SourceScanId;\r\n\r\nlet labeledAssets = PurviewDataSensitivityLogs\r\n| where ActivityType == \"Labeling\"  \r\n| where \"{DataSource:label}\" == \"All\" or SourceType in~ (split(\"{DataSource:label}\", \", \"))\r\n| where \"{Region:label}\" == \"All\" or SourceRegion in~ (split(\"{Region:label}\", \", \"))\r\n| extend CloudProvider = iff((SourceName contains \"Azure\"), \"Azure\", \"Amazon Web Services\")\r\n| where CloudProvider in (split(\"{CloudProvider:label}\", \", \"))\r\n| where \"{Resource:label}\" == \"All\" or SourceName in (split(\"{Resource:label}\", \", \"))\r\n| where \"{PurviewAccount:label}\" == \"All\" or PurviewAccountName in~ (split(\"{PurviewAccount:label}\", \", \"))\r\n| where \"{Subscription:label}\" == \"All\" or SourceSubscriptionId in~ (split(\"{Subscription:label}\", \", \"))\r\n| mv-expand SensitivityLabel to typeof(string)\r\n| mv-expand SensitivityLabelDetails to typeof(string)\r\n| summarize arg_max(TimeGenerated, SensitivityLabel, SourceType, SensitivityLabelDetails, SensitivityLabelTrigger) by AssetPath\r\n| project AssetPath, SensitivityLabel, SensitivityLabelDetails, SensitivityLabelTrigger;\r\n\r\nlet table = labeledAssets\r\n| join kind= fullouter classifiedAssets on AssetPath\r\n| extend Classification = iff((Classification == \"[]\"), \"No Classifications\", Classification)\r\n| where \"{Label:label}\" == \"All\" or (split(\"{Label:label}\", \", \")) contains SensitivityLabel\r\n| project TimeGenerated, PurviewTenantId, PurviewAccountName, PurviewRegion, AssetLastScanTime, AssetName, AssetPath, AssetType, AssetCreationTime, AssetModifiedTime, FileExtension, FileSize, ActivityType, ClassificationTrigger, Classification, ClassificationDetails, SensitivityLabelTrigger, SensitivityLabel, SensitivityLabelDetails, SourceName, SourceType, SourcePath, SourceSubscriptionId, SourceRegion, SourceCollectionName, SourceScanId;\r\n\r\ntable",
        "size": 0,
        "title": "Asset Drilldown",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "Time",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "TimeGenerated",
              "formatter": 5
            },
            {
              "columnMatch": "PurviewTenantId",
              "formatter": 5
            },
            {
              "columnMatch": "PurviewAccountName",
              "formatter": 5
            },
            {
              "columnMatch": "PurviewRegion",
              "formatter": 5
            },
            {
              "columnMatch": "AssetName",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "GenericDetails",
                "linkIsContextBlade": true
              }
            },
            {
              "columnMatch": "AssetPath",
              "formatter": 5,
              "formatOptions": {
                "linkTarget": "GenericDetails",
                "linkIsContextBlade": true
              }
            },
            {
              "columnMatch": "AssetType",
              "formatter": 5
            },
            {
              "columnMatch": "AssetCreationTime",
              "formatter": 5
            },
            {
              "columnMatch": "AssetModifiedTime",
              "formatter": 5
            },
            {
              "columnMatch": "FileExtension",
              "formatter": 5
            },
            {
              "columnMatch": "FileSize",
              "formatter": 5
            },
            {
              "columnMatch": "ActivityType",
              "formatter": 5
            },
            {
              "columnMatch": "ClassificationTrigger",
              "formatter": 5
            },
            {
              "columnMatch": "Classification",
              "formatter": 0,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "No Classifications"
              }
            },
            {
              "columnMatch": "ClassificationDetails",
              "formatter": 5
            },
            {
              "columnMatch": "SensitivityLabelTrigger",
              "formatter": 5
            },
            {
              "columnMatch": "SensitivityLabel",
              "formatter": 0,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "No Label"
              }
            },
            {
              "columnMatch": "SensitivityLabelDetails",
              "formatter": 5
            },
            {
              "columnMatch": "SourceName",
              "formatter": 13,
              "formatOptions": {
                "linkTarget": null,
                "showIcon": true
              }
            },
            {
              "columnMatch": "SourceType",
              "formatter": 5
            },
            {
              "columnMatch": "SourceSubscriptionId",
              "formatter": 5
            },
            {
              "columnMatch": "SourceRegion",
              "formatter": 5
            },
            {
              "columnMatch": "SourceCollectionName",
              "formatter": 5
            },
            {
              "columnMatch": "SourceScanId",
              "formatter": 5
            },
            {
              "columnMatch": "PurviewSubscriptionId",
              "formatter": 5
            },
            {
              "columnMatch": "SourceOwner",
              "formatter": 5
            },
            {
              "columnMatch": "AssetOwner",
              "formatter": 5
            },
            {
              "columnMatch": "ClassificationActivityTrigger",
              "formatter": 5
            },
            {
              "columnMatch": "SensitivityLabelActivityTrigger",
              "formatter": 5
            },
            {
              "columnMatch": "ClassificationCount",
              "formatter": 5
            },
            {
              "columnMatch": "SensitivityLabelGuid",
              "formatter": 5
            },
            {
              "columnMatch": "UserId",
              "formatter": 5
            }
          ],
          "rowLimit": 10000,
          "filter": true,
          "labelSettings": [
            {
              "columnId": "AssetLastScanTime",
              "label": "Asset Last Scan"
            },
            {
              "columnId": "AssetName",
              "label": "Asset Name"
            },
            {
              "columnId": "AssetPath",
              "label": "Asset Path"
            },
            {
              "columnId": "SensitivityLabel",
              "label": "Sensitivity Label"
            },
            {
              "columnId": "SourceName",
              "label": "Source Name"
            },
            {
              "columnId": "SourcePath",
              "label": "Source Path"
            }
          ]
        },
        "sortBy": []
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Search"
      },
      "name": "query - 15",
      "styleSettings": {
        "showBorder": true
      }
    }
  ],
  "fallbackResourceIds": [
    "Azure Security Center"
  ],
  "fromTemplateId": "sentinel-AzurePurview",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}